<%namespace name="base" file="../base.mcftmpl"/>

<%def name="blocks(collection, *others, **kwargs)">${do_blocks((collection,) + others, **kwargs)}</%def>
<%def name="do_blocks(collections, sign=-1, dx=0, dz=0, size=0, destroy=False)">
<%base:loop collection="${collections[0]}" args="when,i,thing">\
<%
  x = z = 0
  x_size = 0
%>\
%for c in collections:
<%
    if isinstance(c[i], Thing):
	t = c[i]
    else:
	t = Thing(c[i].replace("|", " "))
	lines = c[i].split("|")
    lines = t.sign_text()
    signage = ()
    for j in range(0, 3):
	txt = lines[j] if j < len(lines) else ""
	signage += ("Text%d:%s" % (j + 2, text(txt)),)
    try:
	nbt = "{%s}" % t.nbt
    except AttributeError:
	nbt = ""
%>
%if destroy:
    ${when(i)} setblock ~${x} ~3 ~${z} minecraft:air destroy
%endif
${when(i)} setblock ~${x} ~3 ~${z} ${t.full_id()}${nbt}${" destroy" if destroy else ""}
${when(i)} data merge block ~${x} ~2 ~${z + sign} {${",".join(signage)}}
<%
    x += dx
    x_size += 1
    if size == 0:
	z += dz
    elif x_size >= size:
	x = 0
	z += dz
	x_size = 0
%>\
%endfor
</%base:loop>
</%def>\
